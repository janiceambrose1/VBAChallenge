Sub Stocks()

' this loops through all sheets
    For Each ws In Worksheets
    ws.Activate
        
        'This sets the Header in our data
        Range("J1").Value = "Ticker"
        Range("K1").Value = "Yearly Change"
        Range("L1").Value = "Percent Change"
        Range("M1").Value = "Total Stock Volume"
        Range("O2").Value = "Greatest % Increase"
        Range("O3").Value = "Greatest % Decrease"
        Range("O4").Value = "Greatest Total Volume"
        Range("P1").Value = "Ticker"
        Range("Q1").Value = "Value"
        Range("K:M").EntireColumn.AutoFit
        Range("O:O").EntireColumn.AutoFit


        ' this sets the variables we need
        Dim Ticker As String
        Dim Total_Stock_Volume As Double
        Total_Stock_Volume = 0
        Dim Lastrow As Long
        Dim Open_Year_Date As Boolean
        Open_Year_Date = True
        Dim Open_Year_Price As Double
        Dim End_Year_Price As Double
        Dim Yearly_Change As Double
        Dim Percent_Change As Double
        Dim tableRow As Integer
        tableRow = 2


        ' This counts the number of rows in 2014,2015,2016
        Lastrow = ws.Cells(Rows.Count, 1).End(xlUp).Row


        
        For i = 2 To Lastrow
            If Cells(i + 1, 1).Value <> Cells(i, 1).Value Then
                
                Ticker = Cells(i, 1).Value
                
                Total_Stock_Volume = Total_Stock_Volume + Cells(i, 7).Value
                
                Range("J" & tableRow).Value = Ticker
                Range("M" & tableRow).Value = Total_Stock_Volume
                
                End_Year_Price = Cells(i, 6).Value
                Yearly_Change = End_Year_Price - Open_Year_Price
                Range("K" & tableRow).Value = Yearly_Change
                        
                Percent_Change = (Yearly_Change / Open_Year_Price) * 100
                Range("L" & tableRow).Value = Percent_Change
                Range("L" & tableRow).NumberFormat = "0.00%"
                
                If Range("K" & tableRow).Value > 0 Then
                    Range("K" & tableRow).Interior.ColorIndex = 4
                Else
                    Range("K" & tableRow).Interior.ColorIndex = 3
                End If
            
                tableRow = tableRow + 1
            
                Total_Stock_Volume = 0
                
                Open_Year_Date = True
    
            Else
                
                Total_Stock_Volume = Total_Stock_Volume + Cells(i, 7).Value
                
                If Open_Year_Date And Cells(i, 3).Value <> 0 Then
                    Open_Year_Price = Cells(i, 3).Value
                    Open_Year_Date = False
                
                End If
                
                    
            End If
            
        Next i

        ' "Greatest % increase", "Greatest % Decrease"

        Dim n As Integer
        Dim Max_Inc, Min_Dec As Long
        Dim Max_Vol As Double
        Max = 0
        Min = 0
        Max_Vol = 0

        n = ws.Cells(Rows.Count, 11).End(xlUp).Row

        For j = 2 To n
            
            If Range("L" & j).Value > Max Then
                Max = Range("L" & j).Value
                Range("Q2").Value = Max
                Range("P2").Value = Range("J" & j).Value
                        
            ElseIf Range("L" & j).Value < Min Then
                Min = Range("L" & j).Value
                Range("Q3").Value = Range("L" & j).Value
                Range("P3").Value = Range("J" & j).Value

            End If
            
            If Range("M" & j).Value > Max_Vol Then
                Max_Vol = Range("M" & j).Value
                Range("Q4").Value = Max_Vol
                Range("P4").Value = Range("J" & j).Value
            
            End If
            
            Range("Q2:Q3").NumberFormat = "0.00%"
            Range("Q:Q").EntireColumn.AutoFit

            
        Next j

    Next ws

End Sub
